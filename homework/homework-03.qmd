---
title: "Homework - Week 03"
author: "Isabella C. Richmond"
format: html
---

```{r, include = FALSE}
source('R/packages.R')
```

#### Question 1: The first two problems are based on the same data. The data in `data(foxes)` are 116 foxes from 30 different urban groups in England. These fox groups are like street gangs. Group size (`groupsize`) varies from 2 to 8 individuals. Each group maintains its own (almost exclusive) urban territory. Some territories are larger than others. The `area` variable encodes this information. Some territories also have more `avgfood` than others. And food influences the `weight` of each fox. Assume this DAG:

```{r, echo = F, eval = T}
dag <- dagify(
    F ~ A,
    G ~ F,
    W ~ F + G
)

ggdag(dag) +
    theme_dag()
```

where *F* is `avgfood`, *G* is `groupsize`, *A* is `area`, and *W* is `weight`. Use the backdoor criterion and estimate the total causal influence of *A* on *F*. What effect would increasing the territory have on the amount of food inside of it?


Total causal effect of *A* on *F* is just F ~ A. 
```{r}
# get data
data(foxes)
d <- foxes %>% 
  select(c(avgfood, area)) %>%
  mutate(avgfood = standardize(avgfood), 
         area = standardize(area))

# get a list of priors present in the model
default_prior <- get_prior(avgfood ~ area, data = d, family = gaussian())

# load model
tar_load(h03_q1)
m1<- h03_q1

# model formula
m1$formula

# priors
m1$prior

# check diagnostics
plot(m1)

# get a summary of posterior distribution
posterior_summary(m1)

# plot the effect
m1 %>% 
  gather_draws(b_Intercept, b_area, sigma) %>% 
  median_qi() %>%
  ggplot(aes(y = .variable, x = .value, xmin = .lower, xmax = .upper)) + 
  geom_pointinterval() + 
  theme_classic() +
  labs(y = "", x = "mean value +/- 95% CIs")

```

It looks like the effect of territory size on food availability is a strong positive relationship (remember to interpret this as standardized variables - so effect is stronger than it seems).

#### Question 2: Infer the **total** causal effect of adding food, *F*, to a territory on the weight *W* of foxes. Can you calculate the causal effect by simulating an intervention on food?






#### Question 3: Infer the **direct** causal effect of adding food *F* to a territory on the weight *W* of foxes. In light of your estimates from this problem and the previous one, what do you think is going on with these foxes?





#### Question 4: Suppose there is an unovserved confound that influences *F* and *G*, like this: 

```{r, echo = F, eval = T}
dag <- dagify(
    F ~ A + U,
    G ~ F + U,
    W ~ F + G
)

ggdag(dag) +
    theme_dag()
```

Assuming the DAG above is correct, again estimate both the total and direct causal effects of *F* on *W*. What impact does the unobserved confound have?







